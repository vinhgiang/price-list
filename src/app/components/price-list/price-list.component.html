<h1 class="page-header">Price List</h1>
<div class="">
    <form>
        <div class="form-group row">
            <div class="col-2">
                <mat-form-field>
                    <input matInput placeholder="Suplier" aria-label="Suplier" [matAutocomplete]="autoSuplier" [formControl]="suplierCtrl">
                    <mat-autocomplete #autoSuplier="matAutocomplete">
                        <mat-option *ngFor="let suplier of filteredSupliers | async" [value]="suplier.name">
                            <span>{{ suplier.name }}</span>
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>
            <div class="col-2">
                <mat-form-field>
                    <input matInput placeholder="Brand" aria-label="Brand" [matAutocomplete]="autoBrand" [formControl]="brandCtrl">
                    <mat-autocomplete #autoBrand="matAutocomplete">
                        <mat-option *ngFor="let brand of filteredBrands | async" [value]="brand.name">
                            <span>{{ brand.name }}</span>
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>
            <div class="col-2">
                <mat-form-field>
                    <input matInput placeholder="Category" aria-label="Category" [matAutocomplete]="autoCategory" [formControl]="categoryCtrl">
                    <mat-autocomplete #autoCategory="matAutocomplete">
                        <mat-option *ngFor="let category of filteredCategories | async" [value]="category.name">
                            <span>{{ category.name }}</span>
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-4">
                <mat-form-field class="form-col-4">
                    <input matInput placeholder="SKU" value="">
                </mat-form-field>
            </div>
            <div class="col-2">
                <button mat-raised-button color="primary">Search</button>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-12">
                <ngx-datatable #productsTable class="material fullscreen" [rows]="products" [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50"
                    [rowHeight]="auto" [limit]="5" [selectionType]="'single'" (activate)="onActivate($event)" (select)='onSelect($event)'>

                    <ngx-datatable-column name="SKU" [width]="150">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                            <span title="Double click to edit" (dblclick)="editing[rowIndex + '-sku'] = true" *ngIf=" ! editing[rowIndex + '-sku']">
                                {{value}}
                            </span>
                            <input autofocus (blur)="updateValue($event, 'sku', rowIndex)" *ngIf="editing[rowIndex+ '-sku']" type="text" [value]="value" />
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Name" [width]="200">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                            <span title="Double click to edit" (dblclick)="editing[rowIndex + '-name'] = true" *ngIf=" ! editing[rowIndex + '-name']">
                                {{value}}
                            </span>
                            <input autofocus (blur)="updateValue($event, 'name', rowIndex)" *ngIf="editing[rowIndex+ '-name']" type="text" [value]="value" />
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Description" [width]="400">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                            <span title="Double click to edit" (dblclick)="editing[rowIndex + '-description'] = true" *ngIf=" ! editing[rowIndex + '-description']">
                                {{value}}
                            </span>
                            <input autofocus (blur)="updateValue($event, 'description', rowIndex)" *ngIf="editing[rowIndex+ '-description']" type="text" [value]="value" />
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Category" [width]="150" prop="category">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row" let-value="value">
                            <span title="Double click to edit" (dblclick)="editing[rowIndex + '-category'] = true" *ngIf=" ! editing[rowIndex + '-category']">
                                {{value.name}}
                            </span>
                            <select *ngIf="editing[rowIndex + '-category']" (change)="updateValue($event, 'category', rowIndex)" [value]="value._id">
                                <option *ngFor="let category of categories" value="{{ category._id }}">{{ category.name }}</option>
                            </select>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Category eBay AU" [width]="150" prop="category.ebay_au"></ngx-datatable-column>
                    <ngx-datatable-column name="Category eBay UK" [width]="150" prop="category.ebay_uk"></ngx-datatable-column>
                    <ngx-datatable-column name="Brand" [width]="150" prop="brand">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row" let-value="value">
                            <span title="Double click to edit" (dblclick)="editing[rowIndex + '-brand'] = true" *ngIf=" ! editing[rowIndex + '-brand']">
                                {{value.name}}
                            </span>
                            <select *ngIf="editing[rowIndex + '-brand']" (change)="updateValue($event, 'brand', rowIndex)" [value]="value._id">
                                <option *ngFor="let brand of brands" value="{{ brand._id }}">{{ brand.name }}</option>
                            </select>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Price" [width]="100">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                            <span title="Double click to edit" (dblclick)="editing[rowIndex + '-price'] = true" *ngIf=" ! editing[rowIndex + '-price']">
                                {{value}}
                            </span>
                            <input autofocus (blur)="updateValue($event, 'price', rowIndex)" *ngIf="editing[rowIndex+ '-price']" type="text" [value]="value" />
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Last Update" [width]="300" prop="last_update"></ngx-datatable-column>

                    <ngx-datatable-footer>
                        <ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="pageSize" let-selectedCount="selectedCount"
                            let-curPage="curPage" let-offset="offset">
                            <div style="padding: 5px 10px">
                                <div>
                                    Rows: {{rowCount}} | Product per Page: {{pageSize}} | Current Page: {{curPage}}
                                </div>
                            </div>
                            <datatable-pager [pagerLeftArrowIcon]="'datatable-icon-left'" [pagerRightArrowIcon]="'datatable-icon-right'" [pagerPreviousIcon]="'datatable-icon-prev'"
                                [pagerNextIcon]="'datatable-icon-skip'" [page]="curPage" [size]="pageSize" [count]="rowCount"
                                [hidden]=" ! ((rowCount / pageSize) > 1)" (change)="productsTable.onFooterPage($event)">
                            </datatable-pager>
                        </ng-template>

                    </ngx-datatable-footer>
                </ngx-datatable>
            </div>
        </div>
    </form>
</div>